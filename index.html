<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>ESC</title>
        <script src="source/phaser.js"></script>
        <script src="source/Generador.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(600, 400, Phaser.AUTO, 'ESC', { preload: preload, create: create, update: update });

        function preload () {
            
            game.load.image('sky', 'assets/fire.png');
            game.load.image('player', 'assets/Placeholder.png');
            game.load.image('tileo', 'assets/Tileo.png');
            
        }
        
        var mapatiles;
        var tilecolision;
        var cursors;
        var player1;

        function create () {
            
            
            
            cursors = game.input.keyboard.createCursorKeys();
            
            game.stage.backgroundColor = '#2d2d2d';
            
            //game.add.sprite(0, 0, 'sky');
            
            mapatiles = game.add.tilemap(); //Esto añade un mapa vacío al mundo
            
            mapatiles.addTilesetImage('tileo');
            
            
            var capa1 = mapatiles.create('nivel1', 45, 45, 32, 32); //Crea una capa de 45x45 tiles, cada tile 32x32 y la llama nivel1
            capa1.resizeWorld(); //Hace que el mundo sea del mismo tamaño que nuestra capa
            
            createworld(15);
            
            tilecolision = collisionlayer();
           
            for (var i = 0; i < 45; i++){
                for (var j = 0; j < 45; j++){
                    var pos = i*45+j;
                    mapatiles.putTile(tilecolision[pos], i, j, capa1);
                }
            }
            
            
            var capa2 = mapatiles.createBlankLayer('nivel2', 45, 45, 32, 32); //Añade al mundo la capa de colisiones
            
            for (var i = 0; i < 45; i++){
                for (var j = 0; j < 45; j++){
                    var pos = i*45+j;
                    mapatiles.putTile(tilecolision[pos], i, j, capa2);
                }
            }
            mapatiles.setCollision(1, true, capa1); //Le dice que las tiles con 1 colisionan
            //capa1.renderable = false;
            
            game.physics.startSystem(Phaser.Physics.P2JS);
            
            player1 = game.add.sprite(32, 32, 'player');
            
            game.physics.p2.enable(player1);
            
            game.camera.follow(player1);
            
            game.camera.deadzone = new Phaser.Rectangle(100, 100, 400, 200);
        }
        
        function update () {
            
            player1.body.setZeroVelocity();

    if (cursors.up.isDown)
    {
        player1.body.moveUp(300)
    }
    else if (cursors.down.isDown)
    {
        player1.body.moveDown(300);
    }

    if (cursors.left.isDown)
    {
        player1.body.velocity.x = -300;
    }
    else if (cursors.right.isDown)
    {
        player1.body.moveRight(300);
    }
        }

    };

    </script>

    </body>
</html>